+++ 
date = "2020-02-11"
title = "Setting up Pi-hole"
tags = ["netoworking", "pi-hole", "dns" ]
categories = ["blog"]
+++

I've been upgrading my home networking lately.  My house was built with cat 5e cable running through it for phone service.  However, I don't have a landline.  So, I've been changing the wall plates to terminate with cat 5e and wired a lot of my home devices.  The change isn't that noticeable most places.  The only place I've seen a real difference is buffering times from time to time in videos online.

I've been looking at other changes to my home network as well.  One thing that I came across that seemed really intriguing is a project called [Pi-hole](https://pi-hole.net/).

![Pi-hole](/images/pihole.jpg)

Pi-hole is essentially a DNS blocker.

There are lots of bad things on the internet.  Ads, malware, etc.  A lot of these originate from bogus domains made just for these purposes.  Pi-hole takes lists of these bad domains, and when it receives a DNS query for one of these bogus domains, it returns a response the domain doesn't exist.  This means when surfing the web, all the pesky adds you see, are just gone and missing. 

It's also possible for it to return a web page on these requests, but for secure requests such as https, this becomes a lot more difficult as certificates will not match.  For me, it's really just best to respond with that the DNS doesn't exist and check the Pi-hole page if some odd issue occurs.

To install Pi-hole, I'm using a Raspberry Pi 4.  I have flashed raspbian lite on an SD card, and installed docker.  After installing docker, I used the script on the Pi-hole site to run it in docker.  (I love docker.)  All those are really well documented on their respective pages.

I tweaked the ethernet configuration on the raspberry pi to set a static IP, and pointed it to itself as a DNS server.

From ```/etc/dhcpcd.conf``` I added the following lines
```
interface eth0
static ip_address=192.168.1.254/24
static routers=192.168.1.1
static domain_name_servers=127.0.0.1
```

Finally, I configured my router to use the IP of Pi-hole for it's DNS server, and that's it.

Pi-hole also acts as a DNS cache.  When performing a lookup over DNS, the initial lookup of a hostname can take some time.  This usually improves with subsequent accesses to the domain on the same device as OSes usually keep a local cache of host names to IP addresses.  Pi-hole caches these IP lookups, so across devices the queries get sped up because they get accessed off the cache on the Pi-hole which is on the local network, rather than some remote server.

I've been toying with the idea of having Pi-hole as the DHCP server for my network.  It uses dnsmasq under the covers which allows for things such as defining custom domains, which would be really awesome when coupled with manual assignments on the DHCP server.  

For now, I just want to see how well Pi-hole works. If it works well enough, I'll enable other functionality later.

